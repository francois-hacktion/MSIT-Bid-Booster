<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BidBooster — Pipeline AO</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            primary: '#0A66C2',
                            accent: '#00B389',
                            warning: '#F59E0B',
                            danger: '#EF4444',
                            dark: '#0F172A',
                            surface: '#F8FAFC'
                        }
                    },
                    fontFamily: {
                        display: ['Outfit', 'sans-serif'],
                        body: ['Plus Jakarta Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Outfit', sans-serif;
        }

        .sidebar-item {
            transition: all 0.2s ease;
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            background: rgba(10, 102, 194, 0.1);
            border-left-color: #0A66C2;
        }

        .filter-btn.active {
            background: #0A66C2;
            color: white;
        }

        .progress-bar {
            background: linear-gradient(90deg, #0A66C2 0%, #00B389 100%);
        }

        .table-row {
            transition: background 0.15s ease;
        }

        .table-row:hover {
            background: #F8FAFC;
        }

        .sort-btn {
            cursor: pointer;
            user-select: none;
        }

        .sort-btn:hover {
            color: #0A66C2;
        }

        .sort-btn.active {
            color: #0A66C2;
            font-weight: 600;
        }

        .sort-btn.asc::after {
            content: ' ↑';
        }

        .sort-btn.desc::after {
            content: ' ↓';
        }
    </style>
</head>

<body class="bg-gray-50 text-brand-dark">

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="w-56 bg-white border-r border-gray-200 fixed h-full">
            <div class="p-5">
                <a href="index.html" class="flex items-center gap-3">
                    <img src="logos/BidBooster.png" alt="BidBooster" class="h-9">
                </a>
            </div>

            <nav class="px-3 space-y-0.5">
                <a href="dashboard.html"
                    class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border-l-4 border-transparent cursor-pointer">
                    <i data-lucide="layout-dashboard" class="w-4 h-4 text-gray-500"></i>
                    <span class="text-sm font-medium text-gray-600">Dashboard</span>
                </a>
                <a href="pipeline.html"
                    class="sidebar-item active flex items-center gap-3 px-3 py-2.5 rounded-lg border-l-4 border-transparent cursor-pointer">
                    <i data-lucide="inbox" class="w-4 h-4 text-brand-primary"></i>
                    <span class="text-sm font-medium">Pipeline AO</span>
                    <span class="ml-auto bg-brand-primary text-white text-xs px-1.5 py-0.5 rounded-full">12</span>
                </a>
                <a href="#" onclick="openUploadModal(); return false;"
                    class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border-l-4 border-transparent cursor-pointer">
                    <i data-lucide="file-plus" class="w-4 h-4 text-gray-500"></i>
                    <span class="text-sm font-medium text-gray-600">Nouvel AO</span>
                </a>
                <a href="knowledge.html"
                    class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border-l-4 border-transparent cursor-pointer">
                    <i data-lucide="database" class="w-4 h-4 text-gray-500"></i>
                    <span class="text-sm font-medium text-gray-600">Base de Savoir</span>
                </a>
                <a href="analytics.html"
                    class="sidebar-item flex items-center gap-3 px-3 py-2.5 rounded-lg border-l-4 border-transparent cursor-pointer">
                    <i data-lucide="bar-chart-3" class="w-4 h-4 text-gray-500"></i>
                    <span class="text-sm font-medium text-gray-600">Analytics</span>
                </a>
            </nav>

            <!-- User Section -->
            <div class="absolute bottom-0 left-0 right-0 p-3 border-t border-gray-200">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-brand-primary/10 rounded-full flex items-center justify-center">
                        <span class="text-brand-primary font-semibold text-xs">JM</span>
                    </div>
                    <div class="flex-1">
                        <div class="font-medium text-xs">Julie Martin</div>
                        <div class="text-xs text-gray-400">Bid Manager</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 ml-56 p-6">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h1 class="text-2xl font-bold">Pipeline Appels d'Offres</h1>
                    <p class="text-gray-500 text-sm mt-0.5">12 AO actifs • Valeur totale : 34.6M€</p>
                </div>
                <button onclick="openUploadModal()"
                    class="bg-brand-primary text-white px-4 py-2 rounded-lg font-medium hover:bg-brand-primary/90 transition-colors flex items-center gap-2 text-sm cursor-pointer">
                    <i data-lucide="upload" class="w-4 h-4"></i>
                    Analyser un AO
                </button>
            </div>

            <!-- Filters Bar -->
            <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100 mb-4">
                <div class="flex flex-wrap items-center gap-3">
                    <!-- Search -->
                    <div class="flex-1 min-w-[250px]">
                        <div class="relative">
                            <i data-lucide="search"
                                class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                            <input type="text" id="searchInput" placeholder="Rechercher..."
                                class="w-full pl-9 pr-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-primary/20 focus:border-brand-primary">
                        </div>
                    </div>

                    <!-- Status Filter -->
                    <div class="flex items-center gap-1.5">
                        <button onclick="filterByStatus('all')"
                            class="filter-btn active px-2.5 py-1.5 rounded text-xs font-medium border border-gray-200 cursor-pointer"
                            data-status="all">Tous (12)</button>
                        <button onclick="filterByStatus('go')"
                            class="filter-btn px-2.5 py-1.5 rounded text-xs font-medium border border-gray-200 cursor-pointer flex items-center gap-1"
                            data-status="go">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>GO (7)
                        </button>
                        <button onclick="filterByStatus('review')"
                            class="filter-btn px-2.5 py-1.5 rounded text-xs font-medium border border-gray-200 cursor-pointer flex items-center gap-1"
                            data-status="review">
                            <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>Évaluer (3)
                        </button>
                        <button onclick="filterByStatus('nogo')"
                            class="filter-btn px-2.5 py-1.5 rounded text-xs font-medium border border-gray-200 cursor-pointer flex items-center gap-1"
                            data-status="nogo">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>NO-GO (2)
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pipeline Table -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                <!-- Table Header -->
                <div
                    class="grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 border-b border-gray-200 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                    <div class="col-span-3 sort-btn active desc" onclick="sortBy('title')">Projet</div>
                    <div class="col-span-2 sort-btn" onclick="sortBy('client')">Client</div>
                    <div class="col-span-1 text-center sort-btn" onclick="sortBy('status')">Statut</div>
                    <div class="col-span-1 text-right sort-btn" onclick="sortBy('value')">Budget</div>
                    <div class="col-span-1 text-center sort-btn" onclick="sortBy('score')">Score</div>
                    <div class="col-span-2 text-center sort-btn" onclick="sortBy('deadline')">Deadline</div>
                    <div class="col-span-2 text-center">Progression</div>
                </div>

                <!-- Table Body -->
                <div id="pipelineTable" class="divide-y divide-gray-100">
                    <!-- Rows rendered by JS -->
                </div>
            </div>
        </main>
    </div>

    <script>
        lucide.createIcons();

        // Pipeline data
        const pipelineData = [
            { id: 'ao1', title: 'Transformation SI Retail', client: 'Carrefour', sector: 'Retail', value: 2400000, deadline: '2026-02-15', score: 8.6, status: 'go', progress: 65, daysLeft: 11 },
            { id: 'ao2', title: 'Migration Cloud Souverain', client: 'BNP Paribas', sector: 'Banque', value: 4800000, deadline: '2026-02-22', score: 9.1, status: 'go', progress: 40, daysLeft: 18 },
            { id: 'ao3', title: 'Plateforme Data Analytics', client: 'TotalEnergies', sector: 'Énergie', value: 1200000, deadline: '2026-02-28', score: 6.4, status: 'review', progress: 15, daysLeft: 24 },
            { id: 'ao4', title: 'Modernisation ERP', client: 'Société Générale', sector: 'Banque', value: 3200000, deadline: '2026-02-10', score: 4.2, status: 'nogo', progress: 10, daysLeft: 6 },
            { id: 'ao5', title: 'Cybersécurité Zero Trust', client: 'Airbus Defence', sector: 'Défense', value: 5600000, deadline: '2026-03-01', score: 8.9, status: 'go', progress: 25, daysLeft: 25 },
            { id: 'ao6', title: 'Refonte Portail Client', client: 'AXA France', sector: 'Assurance', value: 1800000, deadline: '2026-02-20', score: 7.8, status: 'go', progress: 55, daysLeft: 16 },
            { id: 'ao7', title: 'IA Générative RH', client: 'L\'Oréal', sector: 'Luxe', value: 950000, deadline: '2026-03-05', score: 8.2, status: 'go', progress: 20, daysLeft: 29 },
            { id: 'ao8', title: 'Gestion Logistique', client: 'Geodis', sector: 'Transport', value: 2100000, deadline: '2026-02-25', score: 5.8, status: 'review', progress: 8, daysLeft: 21 },
            { id: 'ao9', title: 'Blockchain Supply Chain', client: 'Renault Group', sector: 'Auto', value: 3500000, deadline: '2026-02-18', score: 3.9, status: 'nogo', progress: 5, daysLeft: 14 },
            { id: 'ao10', title: 'Plateforme IoT Industrielle', client: 'Schneider Electric', sector: 'Industrie', value: 2800000, deadline: '2026-03-10', score: 8.5, status: 'go', progress: 12, daysLeft: 34 },
            { id: 'ao11', title: 'Transformation Digitale', client: 'Crédit Agricole', sector: 'Banque', value: 4200000, deadline: '2026-03-15', score: 7.2, status: 'review', progress: 5, daysLeft: 39 },
            { id: 'ao12', title: 'Système Réservation', client: 'Accor Hotels', sector: 'Tourisme', value: 1600000, deadline: '2026-02-28', score: 8.0, status: 'go', progress: 30, daysLeft: 24 }
        ];

        let currentFilter = 'all';
        let currentSort = { field: 'deadline', direction: 'asc' };

        function formatCurrency(value) {
            if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M€';
            return (value / 1000).toFixed(0) + 'k€';
        }

        function getStatusBadge(status) {
            const badges = {
                go: '<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-700"><span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span>GO</span>',
                review: '<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-700"><span class="w-1.5 h-1.5 bg-yellow-500 rounded-full"></span>Évaluer</span>',
                nogo: '<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-700"><span class="w-1.5 h-1.5 bg-red-500 rounded-full"></span>NO-GO</span>'
            };
            return badges[status];
        }

        function getScoreColor(score) {
            if (score >= 7.5) return 'text-green-600';
            if (score >= 5) return 'text-yellow-600';
            return 'text-red-600';
        }

        function formatDeadline(daysLeft, deadline) {
            const date = new Date(deadline);
            const formatted = date.toLocaleDateString('fr-FR', { day: '2-digit', month: 'short' });
            if (daysLeft <= 7) {
                return `<span class="text-red-600 font-medium">${formatted}</span><span class="text-red-500 text-xs ml-1">(${daysLeft}j)</span>`;
            }
            return `<span>${formatted}</span><span class="text-gray-400 text-xs ml-1">(${daysLeft}j)</span>`;
        }

        function renderPipeline(data) {
            const table = document.getElementById('pipelineTable');
            table.innerHTML = data.map(ao => `
                <div class="table-row grid grid-cols-12 gap-4 px-4 py-3 items-center cursor-pointer" onclick="window.location.href='dashboard.html#ao-detail'">
                    <div class="col-span-3">
                        <div class="font-medium text-sm text-gray-900">${ao.title}</div>
                        <div class="text-xs text-gray-400">${ao.sector}</div>
                    </div>
                    <div class="col-span-2 text-sm text-gray-700">${ao.client}</div>
                    <div class="col-span-1 text-center">${getStatusBadge(ao.status)}</div>
                    <div class="col-span-1 text-right text-sm font-medium">${formatCurrency(ao.value)}</div>
                    <div class="col-span-1 text-center">
                        <span class="text-sm font-bold ${getScoreColor(ao.score)}">${ao.score}</span>
                    </div>
                    <div class="col-span-2 text-center text-sm">${formatDeadline(ao.daysLeft, ao.deadline)}</div>
                    <div class="col-span-2">
                        <div class="flex items-center gap-2">
                            <div class="flex-1 h-1.5 bg-gray-200 rounded-full overflow-hidden">
                                <div class="progress-bar h-full rounded-full" style="width: ${ao.progress}%"></div>
                            </div>
                            <span class="text-xs text-gray-500 w-8">${ao.progress}%</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterByStatus(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.status === status);
            });
            applyFiltersAndSort();
        }

        function sortBy(field) {
            // Update sort direction
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = field === 'deadline' || field === 'title' ? 'asc' : 'desc';
            }

            // Update UI
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.remove('active', 'asc', 'desc');
            });
            event.target.classList.add('active', currentSort.direction);

            applyFiltersAndSort();
        }

        function applyFiltersAndSort() {
            let data = [...pipelineData];

            // Filter
            if (currentFilter !== 'all') {
                data = data.filter(ao => ao.status === currentFilter);
            }

            // Search
            const search = document.getElementById('searchInput').value.toLowerCase();
            if (search) {
                data = data.filter(ao =>
                    ao.title.toLowerCase().includes(search) ||
                    ao.client.toLowerCase().includes(search) ||
                    ao.sector.toLowerCase().includes(search)
                );
            }

            // Sort
            data.sort((a, b) => {
                let valA = a[currentSort.field];
                let valB = b[currentSort.field];

                if (currentSort.field === 'deadline') {
                    valA = a.daysLeft;
                    valB = b.daysLeft;
                }

                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (currentSort.direction === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });

            renderPipeline(data);
        }

        // Init
        document.getElementById('searchInput').addEventListener('input', applyFiltersAndSort);
        applyFiltersAndSort();

        // Upload Modal
        function openUploadModal() {
            document.getElementById('uploadModal').classList.add('active');
        }
        function closeUploadModal() {
            document.getElementById('uploadModal').classList.remove('active');
        }
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeUploadModal();
        });
    </script>

    <!-- Upload Modal -->
    <div id="uploadModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 items-center justify-center hidden"
        style="display: none;">
        <div class="bg-white rounded-xl w-full max-w-md mx-4 shadow-2xl">
            <div class="p-4 border-b border-gray-100 flex items-center justify-between">
                <h3 class="font-bold">Analyser un nouvel AO</h3>
                <button onclick="closeUploadModal()" class="text-gray-400 hover:text-gray-600 cursor-pointer">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-4">
                <div
                    class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-brand-primary hover:bg-brand-primary/5 transition-all cursor-pointer">
                    <i data-lucide="upload-cloud" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                    <h4 class="font-semibold mb-1">Glissez-déposez votre RFP</h4>
                    <p class="text-gray-500 text-sm">PDF, Word, Excel (max 50MB)</p>
                </div>
            </div>
        </div>
    </div>

    <style>
        #uploadModal.active {
            display: flex !important;
        }
    </style>
</body>

</html>